function [x, err] = DOPRI78_step(fun,t0,h,x0)
%DOPRI78_step makes one step of Dormand-Prince method
dim = length(x0);

a = [0.05555555555556 0 0 0 0 0 0 0 0 0 0 0;
0.02083333333333 0.0625 0 0 0 0 0 0 0 0 0 0;
0.03125 0 0.09375 0 0 0 0 0 0 0 0 0;
0.3125 0 -1.171875 1.171875 0 0 0 0 0 0 0 0;
0.0375 0 0 0.1875 0.15 0 0 0 0 0 0 0;
0.04791013711111 0 0 0.1122487127778 -0.02550567377778 0.01284682388889 0 0 0 0 0 0;
0.01691798978729 0 0 0.387848278486 0.0359773698515 0.1969702142157 -0.1727138523405 0 0 0 0 0;
0.06909575335919 0 0 -0.6342479767289 -0.1611975752246 0.1386503094588 0.9409286140358 0.2116363264819 0 0 0 0;
0.183556996839 0 0 -2.468768084316 -0.2912868878163 -0.02647302023312 2.847838764193 0.2813873314699 0.1237448998633 0 0 0;
-1.215424817396 0 0 16.67260866595 0.9157418284168 -6.056605804357 -16.00357359416 14.8493030863 -13.37157573529 5.13418264818 0 0;
0.2588609164383 0 0 -4.774485785489 -0.435093013777 -3.049483332072 5.577920039936 6.155831589861 -5.062104586737 2.193926173181 0.1346279986593 0;
0.8224275996265 0 0 -11.65867325728 -0.7576221166909 0.7139735881596 12.07577498689 -2.12765911392 1.990166207049 -0.234286471544 0.1758985777079 0];

b8 = [0.04174749114153 0 0 0 0 -0.05545232861124 0.2393128072012 0.7035106694034 -0.7597596138145 0.6605630309223 0.1581874825101 -0.2381095387529 0.25];
b7 = [0.02955321367635 0 0 0 0 -0.8286062764878 0.3112409000511 2.4673451906 -2.546941651842 1.443548583677 0.07941559588113 0.04444444444444 0];

c = [0.055555555555556   0.083333333333333   0.125000000000000   0.312500000000000   0.375000000000000   0.147500000000000   0.465000000000000   0.564865451382260   0.650000000000000   0.924656277640504 1 1];

k = zeros(dim,13);

k(:,1) = feval(fun,t0,x0);
for i = 1:12
    x_i = x0;
    for j = 1:i
        x_i = x_i + a(i,j)*h*k(:, i);
    end
    k(:, i+1) = feval(fun,t0 + c(i)*h,x_i);
end

dx8 = zeros(dim,1);
dx7 = zeros(dim,1);
for i = 1:13
    dx8 = dx8 + b8(i)*k(:,i);
    dx7 = dx7 + b7(i)*k(:,i);
end

x  = x0 + h*dx8; %8 ord

x2 = x0 + h*dx7; %7 ord

err = x - x2;

end